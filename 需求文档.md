# **需求文档 (PRD)：小yo 的赛博账本 (Cyber Ledger) v2.0**

## **1\. 项目概述**

本项目是一个面向计算机专业（CS）大学生的离线优先型移动端记账应用（采用 Web 技术构建并打包为 Android APK）。在满足基础记账的同时，集成了算力计费、API换算、多端同步，并引入了高级的“结余结转”预算系统与“强制隔离”的备用金/攒钱系统。应用以本地设备为核心，摆脱对浏览器的依赖，提供沉浸式的移动端原生体验。

## **2\. 技术栈与架构要求**

* **前端框架**：React 18+ (使用 Functional Components 和 Hooks)
* **打包/原生包装案**：优先通过 **Capacitor** 或 **Cordova** (或配置完整的 PWA 方案并封装) 将前端代码构建转化为可安装的 **Android APK**。
* **样式方案**：Tailwind CSS (极简现代移动端风格，适应手机屏幕流式布局，支持暗黑模式切换)
* **图表库**：Recharts 或 ECharts  
* **数据持久化**：以移动端沙盒环境的本地存储 (如 Capacitor Preferences / SQLite 或本地文件系统) 为核心主权，绝对离线可用；辅以后台 WebDAV 插件进行云盘同步。  
* **图标库**：Lucide React

## **3\. 核心数据结构设计 (供 AI 严格参考)**

// 1\. 账户模型  
interface Account {  
  id: string;  
  name: string;             
  type: 'standard' | 'saving'; // standard: 日常账户(微信等); saving: 隔离的攒钱/备用金账户  
  balance: number;          
}

// 2\. 类别模型  
interface Category {  
  id: string;  
  name: string;  
  type: 'expense' | 'income';  
  isAnnualFixed: boolean; // 是否为年度固定支出(如服务器续费)，为 true 则不计入当月预算消耗  
  isRollover: boolean;    // 该分类的预算是否支持结余结转(如算力API)，为 true 则本月未花完的额度累加到下月  
}

// 3\. 账单记录  
interface Transaction {  
  id: string;  
  type: 'expense' | 'income' | 'transfer';  
  amount: number;  
  fromAccountId?: string; // 转出账户 (支出、转账用)  
  toAccountId?: string;   // 转入账户 (收入、转账用)  
  categoryId?: string;      
  date: string;             
  note: string;  
  isReimbursable: boolean;// 是否待报销  
  isReimbursed: boolean;    
}

// 4\. 预算与心愿单模型  
interface Budget {  
  monthlyTotal: number;         // 每月总预算(不含年度支出)  
  categoryLimits: Record\<string, number\>; // 分类特定预算  
  rolloverBalances: Record\<string, number\>; // 记录支持结转的分类当前累计的结余资金  
}

interface SavingGoal {  
  id: string;  
  name: string;           // 如："M4 Mac 基金" 或 "应急备用金"  
  targetAmount: number;   // 目标金额  
  currentAmount: number;  // 当前已存金额  
}

## **4\. 核心功能模块详细说明**

### **4.1 核心记账与 CS 专属组件 (Input Module)**

* **常规表单**：支持支出、收入、转账。记账时必须要求用户**显式地选中“支出账户”或“收入账户”**；转账时明确指定“转出账户”和“转入账户”，彻底杜绝使用底层默认账户盲充。同时包含 \[ \] 待报销 勾选项。
* **高频快捷按钮 (Quick Add)**：在首屏提供 3-4 个自定义快捷记账按钮（例如：“AutoDL 扣费 -2元”、“API 调用 -5元”、“常规餐饮 -15元”），点击一键完成记录，极大提升录入效率。
* **年度支出标记**：当选择的分类（如“服务器/域名”）是 isAnnualFixed=true 时，UI 上需给用户微小提示：“此笔支出将计入年度账单，不消耗当月生活预算”。  
* **AutoDL 算力计算器**：  
  * 下拉选择显卡型号（预设 RTX 3090 约 1.5元/h, RTX 4090 约 2.8元/h, A100 等，且允许用户在设置中自定义/修改预设单价）。  
  * 输入使用时长（小时），失焦后自动计算总金额并填入表单，自动生成标准备注（如：`[AutoDL] RTX 4090 - 15.5小时`）。  
* **API Token 换算器**：  
  * 录入消耗的 Token 数量（如 500K），选择对应的常用模型（如 DeepSeek、GPT-4o 等），按内置费率与实时/固定汇率自动折算人民币金额支出。

### **4.2 高级预算系统 (Advanced Budgeting)**

* **双轨制预算计算与前置管理**：  
  * **年度大盘与月度生活**：系统在【记账】首页提供可视化的预算统筹看板。相关配置项（年度大盘、月度生活额度）**默认折叠，通过独立的“设置”按钮呼出弹窗/折叠面板进行调整，保持主界面的干净与克制**。**年度总预算** = (每月生活预算 × 12) + 所有的年度固定消费总和。
  * **日常消耗警戒**：普通支出正常扣减当月“生活预算”进度条，超80%黄警，超100%红警。年度固定支出（如域名续费）单列大盘并扣减年度总额度，不挤占每个月的日常零花钱。  
  * **结余结转 (Rollover)**：针对独立抽离出来的 `AutoDL` 或 `API` 等专项开销，允许设置特定的每月定额。若某分类本月预算 200，仅花 50，则下月可用预算自动变为 200 + 150 = 350，在 UI 独立呈现“蓄水池”。

### **4.3 强制隔离的攒钱系统 (Savings & Emergency Fund)**

* **虚拟小金库体系**：系统内预设或允许用户创建一个 type: 'saving' 的独立账户（如“备用金账户”）。  
* **记账交互 (转账攒钱)**：用户发工资或想攒钱时，记录一笔“转账”：从 微信 (standard) 转入 备用金 (saving)。  
* **可用余额计算机制**：  
  * **账户动态余额** \= `初始设置金额` \+ `作为toAccountId的总收入/总转入` \- `作为fromAccountId的总支出/总转出`。  
  * **总净资产** \= 所有账户动态余额之和。  
  * **可用活期余额** \= 仅 standard 账户动态余额之和。  
  * *UI 强调*：在首页最醒目的位置展示“可用活期余额”，让用户产生“没钱了”的错觉，从而克制消费。总资产可略微弱化显示。  
* **心愿单动态生命周期**：
  * **自由编排**：类似于分类与账户，系统中必须提供一个管理控制台（设在“我的/设置”页），允许用户自由化地增删改心愿目标（如新建“M4 Mac 基金”，设定目标金额 10,000 元）。
  * **看板快捷注资 (Deposit) 与资金源联动**：在统计大盘为每个进行中的目标配发“注资 +”按钮。用户点击后不仅需要输入金额，更要**显式选择一个“存出账户”（如从“招商银行”转出资金）**；底层引擎随即全自动生成一笔从所选账户到目标储蓄类账户的真实流水，保证微观账户余额与总资产的严密扣合。

### **4.4 报销池追踪系统 (Reimbursement Tracker)**

* **独立面板**：筛选所有 isReimbursable \=== true && isReimbursed \=== false 的支出。  
* **一键平账**：点击后将状态设为已报销，并自动生成一笔等额的“收入（报销款入账）”。

### **4.5 数据可视化看板 (Dashboard)**

* **专属账户陈列面板与大盘**：
  * 首页醒目区分【当前可用活期余额】与【被冻结的备用金】，以及【总资产】。
  * **以单账户为单位的列表陈列**：【资产】页面在展示顶层汇总大盘之余，**必须以卡片列表的形式细颗粒度地展示出当前所有的独立实体账户（如招商银行、微信零钱、存钱罐等）**，并且其上的金额必须是经过历史流水验算后的**当前动态真实精确余额**。
* **年度与月度视图**：  
  * 提供切换 Toggle。月度视图看生活费和算力燃烧速度；年度视图看服务器续费、大件电子产品购买的“年度账单”。  
* **图表展示**：饼图展示支出分类占比；折线图展示赛博消费每日燃烧趋势。

### **4.6 WebDAV 多端同步与极客设置 (Sync & Settings)**

* **WebDAV 同步**：在设置页配置坚果云等 WebDAV 凭据，每次操作后静默向云端推/拉 JSON 数据，实现多端自动同步。  
* **自定义 CSS**：提供文本域注入 CSS，允许用户魔改全局样式。
* **手动兜底备份**：除了自动化云同步外，保留一键“导出为 JSON”和“从 JSON 导入”的基础功能，作为极端情况或跨设备直传的数据兜底方案。

### **4.7 基础配置与全面自定义 (Configuration & Customization)**

针对市面成熟记账软件的标准体验，系统必须彻底告别“硬编码”，将所有核心字典的控制权交还给用户：
* **账户管理体系 (Account Management)**：允许用户自由化地添加、编辑、停用/删除资金实体（例如新建“支付宝”、“微信零钱”、“招商银行卡”）。创建时必须支持录入**初始资金金额**，并指定其安全隔离级别（日常 Standard / 备用金 Saving）。
* **收支分类字典 (Category Dict)**：开放分类的 CRUD。用户可自行新增生活分类，且在配置时暴露出高级极客属性拨动开关（如开启 `isAnnualFixed` 将其排除在月度预算外，开启 `isRollover` 允许它进行闲置资金结转）。
* **年度跨度与全动态预算控制台**：
  * **双轴阀门**：支持配置独立的**「年度总预算」**与**「月度生活总预算」**。年度固定项目由年度预算统筹，不挤占月度粮草。
  * **自定义赛博定额引擎**：摒弃任何代码层面的特定名称匹配（禁用 `cat.name === '赛博消费'` 这类死逻辑）。允许在配置中心为任何开启了结转 (`isRollover=true`) 的特殊分类单独分配**特定限额**，并由统一引擎追踪其余额蓄水池。
* **赛博计算器参数库**：
  * **AutoDL 机型库管理**：在设置页内嵌一张管理表格，用户可随市场价格波动自行增删“RTX 4090”、“H800”及其精确的小时价格。
  * **API 大模型费率库**：同样提供可视化配置清单，允许录入如“DeepSeek-V3”、“GPT-4”的具体 Input/Output Token 费率规则，并设置一个用于整体对冲的全局汇率配置。

### **4.8 高阶流水操作体系 (Advanced Transactions)**

* **历史账单重塑 (Edit & Delete)**：除了提供基于侧滑或点击的账单删除外，必须支持点击单笔流水数据将其直接回填入表单进行**二次编辑修改**。
* **强力搜索与多维过滤 (Search & Filter)**：在账单流水区提供组合型检索功能。支持按关键字模糊搜索备注，或通过日历组件按精准日期/月份范围筛选，以及指定特定账户、特定类目的复合筛选器。

### **4.9 订阅制追踪与多维标签 (Subscriptions & Tags)**

大部分记账软件只提供单一的“分类”，且忽视了现代人的订阅制消费习惯。我们需要做如下细化：
* **多维标签系统 (Tagging System)**：在严谨的 Category（分类）之外，允许为账单打上一个或多个灵活的 Tag（标签）。例如：分类是“服务器续费”，标签是 `#毕业设计项目`；或者分类是“交通”，标签是 `#去北京打比赛`。这能极大提升后期数据分析的灵活度。
* **周期性订阅管理器 (Recurring Subscriptions)**：单列一个面板用于管理如 “ChatGPT Plus”、“Copilot”、“服务器续费”、“Apple Music” 等周期性扣费项目。支持记录其月付/年付周期及续费日期，提前在看板进行“扣费预警”，甚至支持一键将本月或本年订阅批量转化为真实流水记录。

### **4.10 隐私安防与跨界数据兼容 (Privacy & Data Interoperability)**

* **极客隐私锁 (Privacy Lock)**：作为安装在手机上的独立 App，财务数据极易被借用手机的人瞥见。系统需支持设置数字 PIN 码或指纹/人脸识别（调用 Capacitor Biometry 插件），在 App 进入后台或重新唤醒时自动请求验证。
* **数据格式破壁 (CSV 通用导出)**：系统需额外提供直观的 **CSV 格式导出** 功能，方便发送到电脑端使用 Python (Pandas) 或 Excel 对分析。

### **4.11 移动端底部导航与多页架构 (5 Tab 机制)**

随着系统模块大量增量，应用底层引入正规的 5 Tab 移动端底部标签栏 (Bottom Tabs) 架构，彻底贯彻功能模块的领域隔离：
* **[记账/Home]**：最高频的操作入口。包含顶部的总资产与【预算大盘看板(配有设定的折叠/弹窗交互)】、待报销追踪卡片、以及强制要求选择收支账户的核心账单录入表单和快捷记账按钮。
* **[资产/Accounts] (新增)**：专司资金分配与物理实体溯源。除了展示各实体钱袋的动态统合大盘外，**必须并列陈列所有实体账户的独立动态余额卡片**，并且【账户字典编辑】全部收拢在此页。
* **[明细/List]**：专司历史流水回溯与筛查。包含完整的历史账单列表，**必须直观地在每一条流水卡片上标注资金的发生账户（如 [支出] 午餐 - ¥20 (资金源: 微信)）**。支持高维度的多条件交叉搜索框，并提供流水列表的“二次填报修改”入口。
* **[统计/Stats]**：财务透视图表与心愿池。存放饼状分类占比图、燃烧折线图，以及带有“快捷注资 (需显式选择拨出账户)”能力的心愿攒钱单。
* **[我的/Settings]**：系统与字典中控。剥除臃肿的账户与预算逻辑后，这里专注于【分类字典CRUD】、【AutoDL/API费率配置】、【周期性订阅管理】、【UI与同步核心系统参数】的井然有序排布。

## **5\. 开发阶段划分 (移动端重构指南)**

请 AI 助手严格按照以下阶段依次实现并打包测试：

* **Phase 1 (基础框架)**：React \+ Tailwind 初始化。实现核心表单与列表。
* **Phase 2 (移动端壳注入与原生化)**：引入 Capacitor 等桥接工具，配置应用图标、屏闭闪退边界，并实现向 Android APK 的交叉编译与热重载测试。
* **Phase 3 (预算与账户隔离)**：引入 standard/saving 账户逻辑。
* **Phase 4 (CS 专属与结转)**：实现 AutoDL 定价表单、API 换算器和带有 Rollover 控制池的赛博分类；开发报销平账追踪组件。
* **Phase 5 (可视化看板)**：集成 Recharts，制作饼图、折线燃烧图。
* **Phase 6 (全量配置管理)**：实现分类、账户、API字典等基础元数据的自由 CRUD。
* **Phase 7 (底层路由与视图切分)**：引入 `react-router-dom` 或全局动态组件挂载状态，完成底部导航栏 (Bottom Tab) 的切割结构，将组件分发到 4 个独立一级页面。
* **Phase 8 (高阶流水功能)**：搜索、二次编辑以及手机端的系统高频交互菜单。
* **Phase 9 (深海极客特性)**：多维标签系统、周期性订阅日历，最后调用原生接口实现 WebDAV 同步和指纹安全锁。